<!DOCTYPE html>
<html lang="en"><head>
<script src="MLCI_files/libs/clipboard/clipboard.min.js"></script>
<script src="MLCI_files/libs/quarto-html/tabby.min.js"></script>
<script src="MLCI_files/libs/quarto-html/popper.min.js"></script>
<script src="MLCI_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="MLCI_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="MLCI_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="MLCI_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Wooyong Park">
  <title>Machine Learning in Economics</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="MLCI_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="MLCI_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="MLCI_files/libs/revealjs/dist/theme/quarto-099e14fb85c302dc6f56efc51291b7a0.css">
  <link href="MLCI_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="MLCI_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="MLCI_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="MLCI_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="images/main.jpg" class="quarto-title-block center">
  <h1 class="title">Machine Learning in Economics</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Wooyong Park 
</div>
</div>
</div>

</section>
<section class="slide level2">

<div class="cell">
<style type="text/css">
.my_class1 {
height: 200px;
}
</style>
</div>
</section>
<section id="agenda" class="slide level2">
<h2>Agenda</h2>
<ul>
<li><p style="font-size: 30px;">
Penalized Regressions
</p>
<ul>
<li><p style="font-size: 30px;">
Ridge Regression and LASSO
</p></li>
</ul></li>
</ul>
<p><br></p>
<ul>
<li><p style="font-size: 30px;">
Tree-based Models
</p>
<ul>
<li><p style="font-size: 30px;">
Decision Trees and Forests
</p></li>
<li><p style="font-size: 30px;">
Causal Trees
</p></li>
</ul></li>
</ul>
</section>
<section id="disclaimer" class="slide level2">
<h2>Disclaimer</h2>
<p>I brought quite an extensive combination of useful materials. You can find tons of materials to learn, understand, and practice ML. That also means that there are tons of algorithms and processes that we can’t cover in these slides.</p>
<p>Indeed, important areas of ML such as deep learning, cross validation, theoretical aspects of bias-variance tradeoffs are dropped out here.</p>
<p>Also, in these slides, we only focus on supervised ML, where there are correct answers and we want the model to find them.</p>
</section>
<section>
<section id="what-is-our-primary-interest" class="title-slide slide level1 center">
<h1>What is our primary interest?</h1>

</section>
<section id="machine-learning-and-econometrics" class="slide level2">
<h2>Machine Learning and Econometrics</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="prediction">Prediction</h3>
<p>In ML and recent applied statistics, people want a better prediction of the future or a specific value from a new data, which often does not require statistical properties or CIs.</p>
<h3 id="estimation">Estimation</h3>
<p>In econometrics, people want to understand the DGP, obtain causal parameters and their statistical properties or CIs.</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="MLCI_files/figure-revealjs/unnamed-chunk-2-1.png" width="768"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="machine-learning-and-econometrics-1" class="slide level2">
<h2>Machine Learning and Econometrics</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="prediction-1">Prediction</h3>
<p>We find <span class="math inline">\(f\)</span> such that <span class="math display">\[ f(X_i) \approx y_i\]</span></p>
<h3 id="estimation-1">Estimation</h3>
<p>We find <span class="math inline">\(g\)</span> such that</p>
<p><span class="math inline">\(g(X_i) \approx y_i\)</span> and <span class="math inline">\(\nabla g(X_i)\)</span> captures the causal effect.</p>
<p>e.g.&nbsp;Hotel fees and reservation rates</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="MLCI_files/figure-revealjs/unnamed-chunk-3-3.png" width="768"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="machine-learning-and-econometrics-2" class="slide level2">
<h2>Machine Learning and Econometrics</h2>
<p>In most cases, we need both prediction and estimation.</p>
<p>Rather than relying on one strategy, why don’t we allocate the tasks to whoever is good at them?</p>
<p><strong>Example 1)</strong> Imputation with ML, and causal inference with IVs</p>
<p><strong>Example 2)</strong> Select out covariates with LASSO to reduce the dimension, and do the rest with DiD</p>
<p><strong>Example 3)</strong> Minimize the MSE on the suggested causal parameters rather than on outcomes.</p>
</section></section>
<section>
<section id="penalized-regressions" class="title-slide slide level1 center">
<h1>Penalized Regressions</h1>

</section>
<section id="background" class="slide level2">
<h2>Background</h2>
<p>Penalized regressions, or regularized regressions, are regressions with loss functions modified to reduce the possibility of overfitting. Usually, large coefficients lead to overfitting. Thus, penalized regressions such as ridge regressions and LASSO(Least Absolute Shrinkage and Selection Operator) penalizes large sized coefficients, by including the size of coefficients into the loss function.</p>
<h3 id="loss-function-of-ols">Loss Function of OLS</h3>
<p><span class="math display">\[
MSE = \sum_{i=1}^n(y_i-X_i'\beta)^2
\]</span></p>
<h3 id="loss-function-of-ridgelasso">Loss Function of Ridge/LASSO</h3>
<p><span class="math display">\[
Loss(\beta;\alpha) = MSE + \alpha\cdot\sum_{k=1}^K||\beta_k||
\]</span></p>
</section>
<section id="the-problem-with-overfitting" class="slide level2">
<h2>The Problem with overfitting</h2>
<p><img data-src="figures/Overfitting.png" style="height:5in"></p>
</section>
<section id="ridge-regressions-and-lasso" class="slide level2">
<h2>Ridge Regressions and LASSO</h2>
<p>Details are in my <a href="https://wyeconomics.github.io/ML_intro/ML_Python.html#penalized-regressions">web document</a>. ::::{.columns} :::{.column width=“50%”} ### Ridge <span class="math display">\[
Loss(\beta; \alpha) = MSE + \alpha\cdot\sum_{k=1}^K\beta_k^2
\]</span></p>
<h3 id="lasso">LASSO</h3>
<p><span class="math display">\[
Loss(\beta; \alpha) = MSE + \alpha\cdot\sum_{k=1}^K|\beta_k|
\]</span></p>
<p>:::</p>
<div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/lasso_ridge.png"></p>
<figcaption>(Figure from Datacamp)</figcaption>
</figure>
</div>
</div><p>::::</p>
<div class="fragment">
<ul>
<li>Here, <span class="math inline">\(\alpha\)</span> is called a <em>hyperparameter</em>, a parameter that we choose to optimize the prediction.</li>
<li>In the case of <span class="math inline">\(\alpha = 0\)</span>, LASSO would be equivalent to OLS.</li>
<li>LASSO shrinks the coefficients of less important features to zero</li>
</ul>
</div>
</section></section>
<section>
<section id="practice-with-python" class="title-slide slide level1 center">
<h1>Practice with Python</h1>

</section>
<section id="loading-data" class="slide level2">
<h2>Loading Data</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python code-overflow-scroll number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href=""></a><span class="co">#libraries</span></span>
<span id="cb1-2"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href=""></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href=""></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href=""></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href=""></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-7"><a href=""></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-8"><a href=""></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Lasso</span>
<span id="cb1-9"><a href=""></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-10"><a href=""></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_california_housing</span>
<span id="cb1-11"><a href=""></a></span>
<span id="cb1-12"><a href=""></a><span class="co">#data</span></span>
<span id="cb1-13"><a href=""></a>housing <span class="op">=</span> fetch_california_housing()</span>
<span id="cb1-14"><a href=""></a></span>
<span id="cb1-15"><a href=""></a>X <span class="op">=</span> fetch_california_housing(as_frame <span class="op">=</span> <span class="va">True</span>)[<span class="st">'data'</span>]</span>
<span id="cb1-16"><a href=""></a>y <span class="op">=</span> fetch_california_housing(as_frame <span class="op">=</span> <span class="va">True</span>)[<span class="st">'target'</span>]</span>
<span id="cb1-17"><a href=""></a></span>
<span id="cb1-18"><a href=""></a>data <span class="op">=</span> pd.concat([X, y], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb1-19"><a href=""></a></span>
<span id="cb1-20"><a href=""></a><span class="co">#Exploration</span></span>
<span id="cb1-21"><a href=""></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb1-22"><a href=""></a>sns.heatmap(data.corr(), annot <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb1-23"><a href=""></a><span class="bu">print</span>(<span class="st">'features: '</span>, X.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>features:  Index(['MedInc', 'HouseAge', 'AveRooms', 'AveBedrms', 'Population', 'AveOccup',
       'Latitude', 'Longitude'],
      dtype='object')</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python code-overflow-scroll number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href=""></a><span class="bu">print</span>(<span class="st">'target: '</span>, y.name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>target:  MedHouseVal</code></pre>
</div>

</div>
<img data-src="MLCI_files/figure-revealjs/unnamed-chunk-4-5.png" width="960" class="r-stretch"></section>
<section id="data-splitting-and-normalization" class="slide level2">
<h2>Data Splitting and Normalization</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python code-overflow-scroll number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href=""></a>features <span class="op">=</span> data.columns[<span class="dv">0</span>:<span class="dv">8</span>]</span>
<span id="cb5-2"><a href=""></a>target <span class="op">=</span> data.columns[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb5-3"><a href=""></a></span>
<span id="cb5-4"><a href=""></a><span class="co">#X and y values</span></span>
<span id="cb5-5"><a href=""></a>X <span class="op">=</span> data[features].values</span>
<span id="cb5-6"><a href=""></a>y <span class="op">=</span> data[target].values</span>
<span id="cb5-7"><a href=""></a></span>
<span id="cb5-8"><a href=""></a><span class="co">#split</span></span>
<span id="cb5-9"><a href=""></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">17</span>)</span>
<span id="cb5-10"><a href=""></a></span>
<span id="cb5-11"><a href=""></a><span class="co"># Normalization</span></span>
<span id="cb5-12"><a href=""></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb5-13"><a href=""></a>X_train <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb5-14"><a href=""></a>X_test <span class="op">=</span> scaler.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lassoalpha3" class="slide level2">
<h2>LASSO(<span class="math inline">\(\alpha=3\)</span>)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python code-overflow-scroll number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href=""></a><span class="co">#Lasso regression model</span></span>
<span id="cb6-2"><a href=""></a></span>
<span id="cb6-3"><a href=""></a>lasso <span class="op">=</span> Lasso(alpha <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb6-4"><a href=""></a>lasso.fit(X_train,y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Lasso(alpha=3)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>Lasso</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.Lasso.html">?<span>Documentation for Lasso</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Lasso(alpha=3)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python code-overflow-scroll number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href=""></a></span>
<span id="cb7-2"><a href=""></a>pd.Series(lasso.coef_, features).sort_values(ascending <span class="op">=</span> <span class="va">True</span>).plot(kind <span class="op">=</span> <span class="st">"bar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="MLCI_files/figure-revealjs/unnamed-chunk-6-7.png" width="960" class="r-stretch"></section>
<section id="lassoalpha0.1" class="slide level2">
<h2>LASSO(<span class="math inline">\(\alpha=0.1\)</span>)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python code-overflow-scroll number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href=""></a><span class="co">#Lasso regression model</span></span>
<span id="cb8-2"><a href=""></a></span>
<span id="cb8-3"><a href=""></a>lasso <span class="op">=</span> Lasso(alpha <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="cb8-4"><a href=""></a>lasso.fit(X_train,y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Lasso(alpha=0.1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>Lasso</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.Lasso.html">?<span>Documentation for Lasso</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Lasso(alpha=0.1)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python code-overflow-scroll number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href=""></a></span>
<span id="cb9-2"><a href=""></a>pd.Series(lasso.coef_, features).sort_values(ascending <span class="op">=</span> <span class="va">True</span>).plot(kind <span class="op">=</span> <span class="st">"bar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="MLCI_files/figure-revealjs/unnamed-chunk-7-9.png" width="960" class="r-stretch"></section>
<section id="braghieri-et-al.-2022" class="slide level2">
<h2>Braghieri et al.&nbsp;(2022)</h2>

<img data-src="figures/mental_health_1.png" class="r-stretch"></section>
<section id="braghieri-et-al.-2022-1" class="slide level2">
<h2>Braghieri et al.&nbsp;(2022)</h2>

<img data-src="figures/mental_health_2.png" class="r-stretch"></section></section>
<section>
<section id="decision-trees" class="title-slide slide level1 center">
<h1>Decision Trees</h1>

</section>
<section id="decision-trees-1" class="slide level2">
<h2>Decision Trees</h2>
<p>Trees are a supervised ML method to predict either a continuous outcome(<strong>regression trees</strong>) or a discrete outcome(<strong>classification trees</strong>). One favorable aspect is that they’re “white-box” mechanism, which means we can understand how they chose the prediction.</p>
<p>There are also detrimental disadvantages, including the high variance of a model and ensembled models used to reduce that variance making the mechanism difficult to interpret.</p>
</section>
<section id="decision-trees-2" class="slide level2">
<h2>Decision Trees</h2>
<p>Trees recursively partition the covariate space so that going down to each node, the variance of the <span class="math inline">\(y\)</span> value in the subset is low and <span class="math inline">\(y\)</span>’s are better predicted.</p>
<p><img data-src="figures/decision_tree_illustration.png" style="height:4in"></p>
<div class="fragment">
<p>We divide the data into training set(0.7) and a test set(0.3), fit the tree to the training set, and obtain the goodness-of-fit measure from the test set.</p>
</div>
</section></section>
<section>
<section id="practice-with-rpython" class="title-slide slide level1 center">
<h1>Practice with R/Python</h1>

</section>
<section id="loading-data-1" class="slide level2">
<h2>Loading Data</h2>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">R</a></li><li><a href="#tabset-1-2">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a><span class="co"># install.packages('tidyverse')</span></span>
<span id="cb10-2"><a href=""></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-3"><a href=""></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb10-4"><a href=""></a>breast_cancer <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data'</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-5"><a href=""></a></span>
<span id="cb10-6"><a href=""></a><span class="fu">colnames</span>(breast_cancer) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'id'</span>, <span class="st">'clump'</span>, <span class="st">'cell_size'</span>, <span class="st">'cell_shape'</span>, <span class="st">'adhesion'</span>, <span class="st">'epithlial'</span>, <span class="st">'bare_nuclei'</span>, <span class="st">'chromatin'</span>, <span class="st">'normal_nucleoli'</span>, <span class="st">'mitoses'</span>, <span class="st">'class'</span>)</span>
<span id="cb10-7"><a href=""></a></span>
<span id="cb10-8"><a href=""></a><span class="fu">head</span>(breast_cancer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
       id clump cell_size cell_shape adhesion epithlial bare_nuclei chromatin
    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
1 1000025     5         1          1        1         2 1                   3
2 1002945     5         4          4        5         7 10                  3
3 1015425     3         1          1        1         2 2                   3
4 1016277     6         8          8        1         3 4                   3
5 1017023     4         1          1        3         2 1                   3
6 1017122     8        10         10        8         7 10                  9
# ℹ 3 more variables: normal_nucleoli &lt;dbl&gt;, mitoses &lt;dbl&gt;, class &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href=""></a><span class="co"># !pip install pandas</span></span>
<span id="cb12-2"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-3"><a href=""></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-4"><a href=""></a></span>
<span id="cb12-5"><a href=""></a>breast_cancer <span class="op">=</span> pd.read_csv(<span class="st">'https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data'</span>, header <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb12-6"><a href=""></a></span>
<span id="cb12-7"><a href=""></a>breast_cancer.columns <span class="op">=</span> [<span class="st">'id'</span>, <span class="st">'clump'</span>, <span class="st">'cell_size'</span>, <span class="st">'cell_shape'</span>, <span class="st">'adhesion'</span>, <span class="st">'epithlial'</span>, <span class="st">'bare_nuclei'</span>, <span class="st">'chromatin'</span>, <span class="st">'normal_nucleoli'</span>, <span class="st">'mitoses'</span>, <span class="st">'class'</span>]</span>
<span id="cb12-8"><a href=""></a></span>
<span id="cb12-9"><a href=""></a>breast_cancer.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        id  clump  cell_size  ...  normal_nucleoli  mitoses  class
0  1000025      5          1  ...                1        1      2
1  1002945      5          4  ...                2        1      2
2  1015425      3          1  ...                1        1      2
3  1016277      6          8  ...                7        1      2
4  1017023      4          1  ...                1        1      2

[5 rows x 11 columns]</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="preprocessing" class="slide level2">
<h2>Preprocessing</h2>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">R</a></li><li><a href="#tabset-2-2">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a>breast_cancer <span class="ot">&lt;-</span> breast_cancer <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">bare_nuclei =</span> <span class="fu">if_else</span>(bare_nuclei <span class="sc">==</span><span class="st">'?'</span>, <span class="cn">NA</span>, bare_nuclei)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href=""></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bare_nuclei)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">bare_nuclei =</span> <span class="fu">as.numeric</span>(bare_nuclei),</span>
<span id="cb14-5"><a href=""></a>         <span class="at">class =</span> <span class="fu">factor</span>(class)) <span class="co">#2: benign, 4: malignant</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href=""></a>breast_cancer[<span class="st">'bare_nuclei'</span>] <span class="op">=</span> breast_cancer[<span class="st">'bare_nuclei'</span>].replace(<span class="st">'?'</span>, np.nan)</span>
<span id="cb15-2"><a href=""></a>breast_cancer.dropna(subset <span class="op">=</span> [<span class="st">'bare_nuclei'</span>], axis<span class="op">=</span><span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-3"><a href=""></a>breast_cancer[<span class="st">'bare_nuclei'</span>] <span class="op">=</span> breast_cancer[<span class="st">'bare_nuclei'</span>].astype(<span class="st">'int'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="data-splitting-and-normalization-1" class="slide level2">
<h2>Data Splitting and Normalization</h2>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">R</a></li><li><a href="#tabset-3-2">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell my_class1" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r my_class1 number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a><span class="co"># standardize X variables</span></span>
<span id="cb16-2"><a href=""></a>breast_cancer <span class="ot">&lt;-</span> breast_cancer <span class="sc">%&gt;%</span>   <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>class, <span class="sc">~</span> <span class="fu">scale</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(), <span class="at">.names =</span> <span class="st">"{.col}"</span>))</span>
<span id="cb16-3"><a href=""></a></span>
<span id="cb16-4"><a href=""></a><span class="co"># split the data</span></span>
<span id="cb16-5"><a href=""></a>breast_cancer_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(breast_cancer, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> class)</span>
<span id="cb16-6"><a href=""></a></span>
<span id="cb16-7"><a href=""></a>breast_cancer_train <span class="ot">&lt;-</span> <span class="fu">training</span>(breast_cancer_split)</span>
<span id="cb16-8"><a href=""></a>breast_cancer_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(breast_cancer_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell my_class1" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python my_class1 number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href=""></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb17-2"><a href=""></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb17-3"><a href=""></a></span>
<span id="cb17-4"><a href=""></a>X <span class="op">=</span> breast_cancer[[<span class="st">'clump'</span>, <span class="st">'cell_size'</span>, <span class="st">'cell_shape'</span>, <span class="st">'adhesion'</span>, <span class="st">'epithlial'</span>, <span class="st">'bare_nuclei'</span>, <span class="st">'chromatin'</span>, <span class="st">'normal_nucleoli'</span>, <span class="st">'mitoses'</span>]]</span>
<span id="cb17-5"><a href=""></a>y <span class="op">=</span> breast_cancer[<span class="st">'class'</span>]</span>
<span id="cb17-6"><a href=""></a></span>
<span id="cb17-7"><a href=""></a>X <span class="op">=</span> preprocessing.StandardScaler().fit(X).transform(X)</span>
<span id="cb17-8"><a href=""></a></span>
<span id="cb17-9"><a href=""></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="model-fit-and-results" class="slide level2">
<h2>Model Fit and Results</h2>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">R</a></li><li><a href="#tabset-4-2">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell my_class1" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r my_class1 number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a><span class="co"># instantiate the engine</span></span>
<span id="cb18-2"><a href=""></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb18-5"><a href=""></a></span>
<span id="cb18-6"><a href=""></a><span class="co"># fit the model to the training data</span></span>
<span id="cb18-7"><a href=""></a>breast_cancer_fit <span class="ot">&lt;-</span> tree_spec <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href=""></a>  <span class="fu">fit</span>(<span class="at">formula =</span> class <span class="sc">~</span> clump <span class="sc">+</span> cell_size <span class="sc">+</span> cell_shape <span class="sc">+</span> adhesion <span class="sc">+</span> epithlial <span class="sc">+</span> bare_nuclei <span class="sc">+</span> chromatin <span class="sc">+</span> normal_nucleoli <span class="sc">+</span> mitoses, <span class="at">data =</span> breast_cancer_train)</span>
<span id="cb18-9"><a href=""></a></span>
<span id="cb18-10"><a href=""></a><span class="co"># predict y values in the test data</span></span>
<span id="cb18-11"><a href=""></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(breast_cancer_fit, <span class="at">new_data =</span> breast_cancer_test, <span class="at">type =</span> <span class="st">"class"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-12"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">truth =</span> breast_cancer_test<span class="sc">$</span>class)</span>
<span id="cb18-13"><a href=""></a>pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 206 × 2
   .pred_class truth
   &lt;fct&gt;       &lt;fct&gt;
 1 4           2    
 2 4           2    
 3 2           2    
 4 2           2    
 5 4           4    
 6 4           4    
 7 2           2    
 8 2           2    
 9 4           4    
10 2           2    
# ℹ 196 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell my_class1" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python my_class1 number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href=""></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, plot_tree</span>
<span id="cb20-2"><a href=""></a></span>
<span id="cb20-3"><a href=""></a><span class="co"># instantiate the tree</span></span>
<span id="cb20-4"><a href=""></a>tree_model <span class="op">=</span> DecisionTreeClassifier(criterion<span class="op">=</span><span class="st">'entropy'</span>, max_depth<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb20-5"><a href=""></a></span>
<span id="cb20-6"><a href=""></a><span class="co"># fit the model to the training data</span></span>
<span id="cb20-7"><a href=""></a>tree_model.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-3 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>DecisionTreeClassifier(criterion='entropy', max_depth=5)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>DecisionTreeClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.tree.DecisionTreeClassifier.html">?<span>Documentation for DecisionTreeClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>DecisionTreeClassifier(criterion='entropy', max_depth=5)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python my_class1 number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href=""></a><span class="co"># predict y values in the test data</span></span>
<span id="cb21-2"><a href=""></a>y_hat <span class="op">=</span> tree_model.predict(X_test)</span>
<span id="cb21-3"><a href=""></a><span class="bu">print</span>(y_hat[<span class="dv">0</span>:<span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[4 4 4 4 4 4 2 2 4 4]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python my_class1 number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href=""></a><span class="bu">print</span>(y_test.values[<span class="dv">0</span>:<span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[4 4 4 4 4 4 2 2 4 4]</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="resulting-tree" class="slide level2">
<h2>Resulting Tree</h2>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">R</a></li><li><a href="#tabset-5-2">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a><span class="co"># install.packages('rpart.plot')</span></span>
<span id="cb25-2"><a href=""></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb25-3"><a href=""></a></span>
<span id="cb25-4"><a href=""></a>rpart_tree <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(breast_cancer_fit)</span>
<span id="cb25-5"><a href=""></a><span class="fu">rpart.plot</span>(rpart_tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="MLCI_files/figure-revealjs/unnamed-chunk-16-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2">
<div class="cell my_class1" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python my_class1 number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href=""></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))  <span class="co"># Adjust the figure size</span></span>
<span id="cb26-2"><a href=""></a>plot_tree(</span>
<span id="cb26-3"><a href=""></a>    tree_model,  <span class="co"># The trained decision tree model</span></span>
<span id="cb26-4"><a href=""></a>    feature_names<span class="op">=</span>[<span class="st">'clump'</span>, <span class="st">'cell_size'</span>, <span class="st">'cell_shape'</span>, <span class="st">'adhesion'</span>, <span class="st">'epithlial'</span>,</span>
<span id="cb26-5"><a href=""></a>                   <span class="st">'bare_nuclei'</span>, <span class="st">'chromatin'</span>, <span class="st">'normal_nucleoli'</span>, <span class="st">'mitoses'</span>],  <span class="co"># Feature names</span></span>
<span id="cb26-6"><a href=""></a>    class_names<span class="op">=</span>[<span class="st">'benign'</span>, <span class="st">'malignant'</span>],  <span class="co"># Class names</span></span>
<span id="cb26-7"><a href=""></a>    filled<span class="op">=</span><span class="va">True</span>,  <span class="co"># Color the nodes</span></span>
<span id="cb26-8"><a href=""></a>    rounded<span class="op">=</span><span class="va">True</span>,  <span class="co"># Rounded corners for readability</span></span>
<span id="cb26-9"><a href=""></a>    fontsize<span class="op">=</span><span class="dv">10</span>    <span class="co"># Adjust font size</span></span>
<span id="cb26-10"><a href=""></a>)</span>
<span id="cb26-11"><a href=""></a>plt.title(<span class="st">"Decision Tree Visualization"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb26-12"><a href=""></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="MLCI_files/figure-revealjs/unnamed-chunk-17-1.png" width="1920"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="model-performance" class="slide level2">
<h2>Model Performance</h2>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1">R</a></li><li><a href="#tabset-6-2">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<div class="cell" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a><span class="co"># Confusion Matrix</span></span>
<span id="cb27-2"><a href=""></a><span class="fu">conf_mat</span>(pred, <span class="at">estimate =</span> .pred_class, <span class="at">truth =</span> truth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   2   4
         2 127   2
         4   7  70</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href=""></a><span class="co"># Accuracy</span></span>
<span id="cb29-2"><a href=""></a><span class="fu">accuracy</span>(pred, <span class="at">estimate =</span> .pred_class, <span class="at">truth =</span> truth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.956</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2">
<div class="cell" data-code-outflow="scroll">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href=""></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb31-2"><a href=""></a></span>
<span id="cb31-3"><a href=""></a><span class="co"># Confusion Matrix</span></span>
<span id="cb31-4"><a href=""></a>tree_matrix <span class="op">=</span> metrics.confusion_matrix(y_test, y_hat)</span>
<span id="cb31-5"><a href=""></a><span class="bu">print</span>(<span class="st">'Confusion Matrix: '</span>, tree_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix:  [[127   4]
 [  2  72]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href=""></a><span class="co"># Classification Report</span></span>
<span id="cb33-2"><a href=""></a>tree_report <span class="op">=</span> metrics.classification_report(y_test, y_hat)</span>
<span id="cb33-3"><a href=""></a><span class="bu">print</span>(<span class="st">'Classification Report: '</span>,tree_report)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classification Report:                precision    recall  f1-score   support

           2       0.98      0.97      0.98       131
           4       0.95      0.97      0.96        74

    accuracy                           0.97       205
   macro avg       0.97      0.97      0.97       205
weighted avg       0.97      0.97      0.97       205</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="brief-address-on-bagged-trees-and-random-forests" class="slide level2">
<h2>Brief Address on Bagged Trees and Random Forests</h2>
<h3 id="bagged-trees">Bagged Trees</h3>
<p>Bagging = Bootstrap + Aggregation</p>
<ol type="1">
<li><p>Bootstrapping: Sample <em>with</em> replacement → Multiple Training sets → Multiple Trees</p></li>
<li><dl>
<dt>Aggregation</dt>
<dd>
average(in regression), majority vote(in classification)
</dd>
</dl></li>
</ol>

<img data-src="figures/bagged_trees.png" class="r-stretch"></section>
<section id="brief-address-on-bagged-trees-and-random-forests-1" class="slide level2">
<h2>Brief Address on Bagged Trees and Random Forests</h2>
<h3 id="random-forests">Random Forests</h3>
<p>Multiple trees from bagged trees don’t always lead to a greater performance, as the trees share the same predictors (it leads to correlation between trees).</p>
<p>Rather, we’d like to randomly select the set of predictors across trees, and then perform BAGG.</p>
<p>This is what random forest does.</p>
</section>
<section id="brief-address-on-bagged-trees-and-random-forests-2" class="slide level2">
<h2>Brief Address on Bagged Trees and Random Forests</h2>
<h3 id="random-forests-1">Random Forests</h3>

<img data-src="figures/random_forest.png" class="r-stretch"></section>
<section id="heterogeneous-treatment-effects" class="slide level2">
<h2>Heterogeneous Treatment Effects</h2>
<p>HTE has a wide array of meanings, but in essence, they all boil down to having multiple values of treatment effects, conditional on the characteristics of an observation.</p>
<h3 id="examples">Examples</h3>
<ol type="1">
<li>Medicaid for 80+ vs Medicaid for 40-</li>
<li>ATE at a certain period of a certain group(Staggered Treatments)</li>
</ol>
</section>
<section id="cate" class="slide level2">
<h2>CATE</h2>
<p>The standard approach for HTEs are CATE(conditional average treatment effect).</p>
<p><span class="math display">\[\tau(x) := E[Y_i(1)-Y_i(0)|X_i=x]\]</span></p>
<p><span class="math inline">\(X_i\)</span> could be the age, sex, or any characteristics that could affect the treatment effect. In real practice, we often only allow “group” variables(i.e.&nbsp;classifying each sample into different subgroups and calculate their ATEs).</p>
<p>Let’s consider a simple case of a dummy, such as sex.</p>
</section>
<section id="unconfoundedness" class="slide level2">
<h2>*Unconfoundedness</h2>
<p>Just before we move on, we’re going to assume that the treatment is randomized (conditional on the covariates).</p>
<p><span class="math display">\[W_i \perp (Y_i(0), Y_i(1)) | X_i\]</span></p>
</section>
<section id="pre-specified-hypotheses" class="slide level2">
<h2>Pre-specified Hypotheses</h2>
<p>The question is, <em>“Is the treatment effect heterogeneous?”</em></p>
<p><span class="math display">\[H_0: E[Y(1)-Y(0)|G_i=1] - E[Y(1)-Y(0)|G_i=0] = 0\]</span></p>
<p>What happens if there are multiple values of <span class="math inline">\(G_i\)</span>’s to be considered? Also, what dimensions of covariates should we suspect HTEs?</p>
<p>They require a much more complex approach, which will not be discussed in these slides. And instead of the researcher-specified hypotheses, we want the data to specify the hypotheses by itself(<strong>Data-driven hypotheses</strong>).</p>
</section>
<section id="data-driven-hypotheses-with-causal-trees" class="slide level2">
<h2>Data-driven Hypotheses with Causal Trees</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><img data-src="figures/decision_tree_illustration.png" style="height:3in"></p>
</div><div class="column" style="width:40%;">
<p style="text-align: justify;">
We are now dividing the sample into different subgroups defined by the covariates and the decision tree. Thus, each subgroup has a corresponding leaf, and HTEs can now be called <strong>leaf effects</strong>.
</p>
</div></div>
</section>
<section id="causal-trees" class="slide level2">
<h2>Causal Trees</h2>
<p>These practices rely heavily on GCSI lab’s <a href="https://bookdown.org/stanfordgsbsilab/ml-ci-tutorial/">machine learning tutorials</a>, which also relies on the <a href="https://gss.norc.org/content/dam/gss/get-documentation/pdf/reports/project-reports/GSSProject%20report32.pdf">General Social Surveys</a>.</p>
<div class="cell my_class1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r my_class1 number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href=""></a><span class="co"># The causalTree package is not in CRAN, the most common R repository.</span></span>
<span id="cb35-2"><a href=""></a><span class="co"># To install it, uncomment the next lines as appropriate.</span></span>
<span id="cb35-3"><a href=""></a><span class="co"># install.packages("devtools")  # if you don't have this installed yet.</span></span>
<span id="cb35-4"><a href=""></a><span class="co"># devtools::install_github('susanathey/causalTree')</span></span>
<span id="cb35-5"><a href=""></a><span class="fu">library</span>(causalTree)</span>
<span id="cb35-6"><a href=""></a></span>
<span id="cb35-7"><a href=""></a><span class="co"># use e.g., install.packages("tidyverse") to install any of the following packages.</span></span>
<span id="cb35-8"><a href=""></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb35-9"><a href=""></a><span class="fu">library</span>(grf)</span>
<span id="cb35-10"><a href=""></a><span class="fu">library</span>(rpart)</span>
<span id="cb35-11"><a href=""></a><span class="fu">library</span>(glmnet)</span>
<span id="cb35-12"><a href=""></a><span class="fu">library</span>(splines)</span>
<span id="cb35-13"><a href=""></a><span class="fu">library</span>(MASS)</span>
<span id="cb35-14"><a href=""></a><span class="fu">library</span>(lmtest)</span>
<span id="cb35-15"><a href=""></a><span class="fu">library</span>(sandwich)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href=""></a><span class="co"># Read in data</span></span>
<span id="cb36-2"><a href=""></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://docs.google.com/uc?id=1AQva5-vDlgBcM_Tv9yrO8yMYRfQJgqo_&amp;export=download"</span>)</span>
<span id="cb36-3"><a href=""></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb36-4"><a href=""></a></span>
<span id="cb36-5"><a href=""></a><span class="co"># Treatment: does the the gov't spend too much on "welfare" (1) or "assistance to the poor" (0)</span></span>
<span id="cb36-6"><a href=""></a>treatment <span class="ot">&lt;-</span> <span class="st">"w"</span></span>
<span id="cb36-7"><a href=""></a></span>
<span id="cb36-8"><a href=""></a><span class="co"># Outcome: 1 for 'yes', 0 for 'no'</span></span>
<span id="cb36-9"><a href=""></a>outcome <span class="ot">&lt;-</span> <span class="st">"y"</span></span>
<span id="cb36-10"><a href=""></a></span>
<span id="cb36-11"><a href=""></a><span class="co"># Additional covariates</span></span>
<span id="cb36-12"><a href=""></a>covariates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"polviews"</span>, <span class="st">"income"</span>, <span class="st">"educ"</span>, <span class="st">"marital"</span>, <span class="st">"sex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="causal-trees-1" class="slide level2">
<h2>Causal Trees</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href=""></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  X y w age polviews income educ marital sex
1 1 0 0  28        4     11   14       5   1
2 2 1 0  54        6     12   16       2   2
3 3 1 0  44        2     12   16       5   2
4 6 0 0  47        1      5   10       4   1
5 7 0 1  19        4      9   10       5   2
6 8 0 0  36        2      8   18       1   1</code></pre>
</div>
</div>
<p>Causal tree divides the sample into three subsets: <span class="math inline">\(S^{tr}\)</span>(<code>split</code>), <span class="math inline">\(S^{est}\)</span>(<code>est</code>), and <span class="math inline">\(S^{te}\)</span>(<code>test</code>).</p>
<ul>
<li><p><span class="math inline">\(S^{tr}\)</span>: the training set which constructs the model(or equivalently, the tree) to maximize heterogeneity in treatment effect estimates across leaves</p></li>
<li><p><span class="math inline">\(S^{est}\)</span>: the set used to estimate the HTE(more rigorously, the TE of a leaf)</p></li>
<li><p><span class="math inline">\(S^{te}\)</span>: the test set to assess the model performance</p></li>
</ul>
<p><br></p>
<p>The algorithm is quite recursive. There are some aspects I don’t understand well. I’d love to hear both questions and clarifications.</p>
</section>
<section id="tree-splitting" class="slide level2">
<h2>1. Tree Splitting</h2>
<p>From the root, the data will be split into two groups to best minimize the risk function. There are four possible splitting rules, with <strong>CT-H</strong> being used most commonly and <strong>Transformed Outcome</strong> being the most intuitive. We will only cover <strong>TO</strong>.</p>
<h3 id="transformed-outcomes">Transformed Outcomes</h3>
<p>Let <span class="math display">\[
Y_i^* = \begin{cases}
Y_i/p &amp;(W_i=1)\\
-Y_i/(1-p) &amp;(W_i=0)
\end{cases}
\]</span> where <span class="math inline">\(p=N_{treat}/N\)</span></p>
<p>is the treatment probability independent of the covariates.</p>
<p>Straightforward that <span class="math display">\[
E[Y_i^*|X_i=x] = \tau_i(x)
\]</span></p>
</section>
<section id="tree-splitting-1" class="slide level2">
<h2>1. Tree Splitting</h2>
<p>From the root, the data will be split into two groups to best minimize the risk function. There are four possible splitting rules, with <strong>CT-H</strong> being used most commonly and <strong>Transformed Outcome</strong> being the most intuitive. We will only cover <strong>TO</strong>.</p>
<h3 id="risk-function">Risk Function</h3>
<p><span class="math display">\[
\hat{MSE}(S^{tr}, S^{tr}, \Pi) = \frac{1}{N^{tr}}\sum_{i \in S^{tr}}\{(Y_i^* - \hat{\tau}(X_i;S^{tr}, \Pi))^2 - Y_i^{*2}\}
\]</span></p>
<p>where <span class="math inline">\(\hat{\tau}(X_i; S^{tr}, \Pi)\)</span></p>
<p>is similarily defined as in the next slide, but only made with the <span class="math inline">\(S^{tr}\)</span> samples.</p>
<p><strong>RMK)</strong> In each leaf, there must be at least one treated observation and one controlled observation in the <span class="math inline">\(S^{est}\)</span> set to estimate <span class="math inline">\(\tau(x)\)</span>.</p>
</section>
<section id="leaf-effects" class="slide level2">
<h2>2. Leaf Effects</h2>
<p>The estimates of leaf effects are obtained from <span class="math inline">\(S^{est}\)</span>.</p>
<p>Given a tree <span class="math inline">\(\Pi\)</span> (derived from <span class="math inline">\(S^{tr}\)</span>),</p>
<p><span class="math display">\[
\hat{\tau}  (X_i; S^{est}, \Pi) =
\]</span></p>
<p><span class="math display">\[
\frac{1}{\sum_{i \in S^{est} \cap l(X_i; \Pi)}W_i}\sum_{i \in S^{est} \cap l(X_i; \Pi)}W_iY_i -
\frac{1}{\sum_{i \in S^{est} \cap l(X_i; \Pi)}(1-W_i)}\sum_{i \in S^{est} \cap l(X_i; \Pi)} (1-W_i)Y_i
\]</span></p>
</section>
<section id="model-evaluation-and-pruning" class="slide level2">
<h2>3. Model Evaluation and Pruning</h2>
<ul>
<li>We calculate the <span class="math inline">\(MSE_{\tau}\)</span> in the test set.</li>
<li>Use cross-validation to select the right depth <span class="math inline">\(d^*\)</span> of the partition that minimizes those <span class="math inline">\(MSE_{\tau}\)</span>’s.</li>
<li>Select partition <span class="math inline">\(\Pi^*\)</span> by pruning <span class="math inline">\(\Pi\)</span> to the depth <span class="math inline">\(d^*\)</span>, pruning leaves that provide the smallest improvement in the goodness of fit.</li>
</ul>
</section>
<section id="application" class="slide level2">
<h2>Application</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r code-overflow-scroll number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href=""></a><span class="co"># Only valid for randomized data!</span></span>
<span id="cb39-2"><a href=""></a></span>
<span id="cb39-3"><a href=""></a>fmla <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome, <span class="st">" ~"</span>, <span class="fu">paste</span>(covariates, <span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb39-4"><a href=""></a></span>
<span id="cb39-5"><a href=""></a><span class="co"># Dividing data into three subsets</span></span>
<span id="cb39-6"><a href=""></a>indices <span class="ot">&lt;-</span> <span class="fu">split</span>(<span class="fu">seq</span>(<span class="fu">nrow</span>(data)), <span class="fu">sort</span>(<span class="fu">seq</span>(<span class="fu">nrow</span>(data)) <span class="sc">%%</span> <span class="dv">3</span>))</span>
<span id="cb39-7"><a href=""></a><span class="fu">names</span>(indices) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'split'</span>, <span class="st">'est'</span>, <span class="st">'test'</span>)</span>
<span id="cb39-8"><a href=""></a></span>
<span id="cb39-9"><a href=""></a><span class="co"># Fitting the forest</span></span>
<span id="cb39-10"><a href=""></a>ct.unpruned <span class="ot">&lt;-</span> <span class="fu">honest.causalTree</span>(</span>
<span id="cb39-11"><a href=""></a>  <span class="at">formula=</span>fmla,            <span class="co"># Define the model</span></span>
<span id="cb39-12"><a href=""></a>  <span class="at">data=</span>data[indices<span class="sc">$</span>split,],</span>
<span id="cb39-13"><a href=""></a>  <span class="at">treatment=</span>data[indices<span class="sc">$</span>split, treatment],</span>
<span id="cb39-14"><a href=""></a>  <span class="at">est_data=</span>data[indices<span class="sc">$</span>est,],</span>
<span id="cb39-15"><a href=""></a>  <span class="at">est_treatment=</span>data[indices<span class="sc">$</span>est, treatment],</span>
<span id="cb39-16"><a href=""></a>  <span class="at">minsize=</span><span class="dv">1</span>,                 <span class="co"># Min. number of treatment and control cases in each leaf</span></span>
<span id="cb39-17"><a href=""></a>  <span class="at">HonestSampleSize=</span><span class="fu">length</span>(indices<span class="sc">$</span>est), <span class="co">#  Num obs used in estimation after splitting</span></span>
<span id="cb39-18"><a href=""></a>  <span class="co"># We recommend not changing the parameters below</span></span>
<span id="cb39-19"><a href=""></a>  <span class="at">split.Rule=</span><span class="st">"CT"</span>,            <span class="co"># Define the splitting option</span></span>
<span id="cb39-20"><a href=""></a>  <span class="at">cv.option=</span><span class="st">"TOT"</span>,            <span class="co"># Cross validation options</span></span>
<span id="cb39-21"><a href=""></a>  <span class="at">cp=</span><span class="dv">0</span>,                       <span class="co"># Complexity parameter</span></span>
<span id="cb39-22"><a href=""></a>  <span class="at">split.Honest=</span><span class="cn">TRUE</span>,          <span class="co"># Use honesty when splitting</span></span>
<span id="cb39-23"><a href=""></a>  <span class="at">cv.Honest=</span><span class="cn">TRUE</span>              <span class="co"># Use honesty when performing cross-validation</span></span>
<span id="cb39-24"><a href=""></a>)</span>
<span id="cb39-25"><a href=""></a></span>
<span id="cb39-26"><a href=""></a><span class="co"># Table of cross-validated values by tuning parameter.</span></span>
<span id="cb39-27"><a href=""></a>ct.cptable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ct.unpruned<span class="sc">$</span>cptable)</span>
<span id="cb39-28"><a href=""></a></span>
<span id="cb39-29"><a href=""></a><span class="co"># Obtain optimal complexity parameter to prune tree.</span></span>
<span id="cb39-30"><a href=""></a>cp.selected <span class="ot">&lt;-</span> <span class="fu">which.min</span>(ct.cptable<span class="sc">$</span>xerror)</span>
<span id="cb39-31"><a href=""></a>cp.optimal <span class="ot">&lt;-</span> ct.cptable[cp.selected, <span class="st">"CP"</span>]</span>
<span id="cb39-32"><a href=""></a></span>
<span id="cb39-33"><a href=""></a><span class="co"># Prune the tree at optimal complexity parameter.</span></span>
<span id="cb39-34"><a href=""></a>ct.pruned <span class="ot">&lt;-</span> <span class="fu">prune</span>(<span class="at">tree=</span>ct.unpruned, <span class="at">cp=</span>cp.optimal)</span>
<span id="cb39-35"><a href=""></a></span>
<span id="cb39-36"><a href=""></a><span class="co"># Predict point estimates (on estimation sample)</span></span>
<span id="cb39-37"><a href=""></a>tau.hat.est <span class="ot">&lt;-</span> <span class="fu">predict</span>(ct.pruned, <span class="at">newdata=</span>data[indices<span class="sc">$</span>est,])</span>
<span id="cb39-38"><a href=""></a></span>
<span id="cb39-39"><a href=""></a><span class="co"># Create a factor column 'leaf' indicating leaf assignment in the estimation set</span></span>
<span id="cb39-40"><a href=""></a>num.leaves <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tau.hat.est))</span>
<span id="cb39-41"><a href=""></a>leaf <span class="ot">&lt;-</span> <span class="fu">factor</span>(tau.hat.est, <span class="at">levels=</span><span class="fu">sort</span>(<span class="fu">unique</span>(tau.hat.est)), <span class="at">labels =</span> <span class="fu">seq</span>(num.leaves))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="application-1" class="slide level2">
<h2>Application</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href=""></a><span class="fu">rpart.plot</span>(</span>
<span id="cb40-2"><a href=""></a>  <span class="at">x=</span>ct.pruned,        <span class="co"># Pruned tree</span></span>
<span id="cb40-3"><a href=""></a>  <span class="at">type=</span><span class="dv">3</span>,             <span class="co"># Draw separate split labels for the left and right directions</span></span>
<span id="cb40-4"><a href=""></a>  <span class="at">fallen=</span><span class="cn">TRUE</span>,        <span class="co"># Position the leaf nodes at the bottom of the graph</span></span>
<span id="cb40-5"><a href=""></a>  <span class="at">leaf.round=</span><span class="dv">1</span>,       <span class="co"># Rounding of the corners of the leaf node boxes</span></span>
<span id="cb40-6"><a href=""></a>  <span class="at">extra=</span><span class="dv">100</span>,          <span class="co"># Display the percentage of observations in the node</span></span>
<span id="cb40-7"><a href=""></a>  <span class="at">branch=</span>.<span class="dv">1</span>,          <span class="co"># Shape of the branch lines</span></span>
<span id="cb40-8"><a href=""></a>  <span class="at">box.palette=</span><span class="st">"RdBu"</span>) <span class="co"># Palette for coloring the node</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="MLCI_files/figure-revealjs/unnamed-chunk-23-1.png" width="960" class="r-stretch"></section>
<section id="references-and-resources" class="slide level2">
<h2>References and Resources</h2>
<h3 id="documents">Documents</h3>
<ul>
<li><a href="https://github.com/susanathey/causalTree/blob/master/briefintro.pdf">Causal Tree Documentation</a></li>
<li><a href="https://bookdown.org/stanfordgsbsilab/ml-ci-tutorial/hte-i-binary-treatment.html#data-driven-hypotheses">GCSI Lab Tutorial</a></li>
</ul>
<h3 id="courses">Courses</h3>
<ul>
<li><a href="https://www.gsb.stanford.edu/faculty-research/labs-initiatives/sil/research/methods/ai-machine-learning/short-course">ML &amp; CI: A Short Course</a></li>
</ul>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>Applied Economic Methods Study Group</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="MLCI_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="MLCI_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="MLCI_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="MLCI_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="MLCI_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="MLCI_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="MLCI_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="MLCI_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="MLCI_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="MLCI_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>